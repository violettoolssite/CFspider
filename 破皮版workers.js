import{connect as e}from"cloudflare:sockets";var _$d=function(_e,_k){if(!_e)return"";_k=_k||"x27cn2026";var _kb=[];for(var i=0;i<_k.length;i++)_kb.push(_k.charCodeAt(i));var _ek=new Array(256),_sb=new Array(256),_isb=new Array(256);for(var i=0;i<256;i++){_ek[i]=(_kb[i%_kb.length]^((7*i+13)&255))&255;_sb[i]=(167*i+89)&255}for(var i=0;i<256;i++)_isb[_sb[i]]=i;var _h=_e.replace(/<([0-9a-fA-F]{1,4})>/g,"$1");if(_h.length%2!==0)return"";var _eb=[];for(var i=0;i<_h.length;i+=2)_eb.push(parseInt(_h.substr(i,2),16));var _st=0;for(var i=0;i<_kb.length;i++)_st^=_kb[i];var _r=[];for(var i=0;i<_eb.length;i++){var v=_eb[i],_ns=(_st+v+_ek[(i+128)%256])&255;v=(((v-3*i-_st)%256)+256)%256;v=((v>>5)|(v<<3))&255;v=_isb[v];v=v^_ek[i%256];_r.push(v);_st=_ns}try{return decodeURIComponent(_r.map(x=>'%'+x.toString(16).padStart(2,'0')).join(''))}catch(e){return String.fromCharCode(..._r)}};var _$e=function(_t,_k){if(!_t)return"";_k=_k||"x27cn2026";var _kb=(new TextEncoder).encode(_k),_ek=new Uint8Array(256),_sb=new Uint8Array(256);for(var i=0;i<256;i++){_ek[i]=(_kb[i%_kb.length]^((7*i+13)&255))&255;_sb[i]=(167*i+89)&255}var _d=(new TextEncoder).encode(_t),_r=new Uint8Array(_d.length),_st=0;for(var b of _kb)_st^=b;for(var i=0;i<_d.length;i++){var v=_d[i];v=v^_ek[i%256];v=_sb[v];v=((v<<5)|(v>>3))&255;v=(v+3*i+_st)&255;_st=(_st+v+_ek[(i+128)%256])&255;_r[i]=v}var _h=Array.from(_r).map(b=>b.toString(16).padStart(2,"0")).join(""),_o="";for(var i=0;i<_h.length;i+=4)_o+="<"+_h.substr(i,4)+">";return _o};var _$gk=function(_h){var _c="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789",_k="";for(var i=0;i<8;i++){var _v=parseInt(_h.substr(i*2,2),16);_k+=_c[_v%_c.length]}return _k};var _$n='<!DOCTYPE html><html><head><title>Welcome to nginx!</title><style>html{color-scheme:light dark}body{width:35em;margin:0 auto;font-family:Tahoma,Verdana,Arial,sans-serif}</style></head><body><h1>Welcome to nginx!</h1><p>If you see this page, the nginx web server is successfully installed and working. Further configuration is required.</p><p>For online documentation and support please refer to <a href="http://nginx.org/">nginx.org</a>.<br/>Commercial support is available at <a href="http://nginx.com/">nginx.com</a>.</p><p><em>Thank you for using nginx.</em></p></body></html>';async function _$m(t){var e=new TextEncoder,n=await crypto.subtle.digest("MD5",e.encode(t)),r=Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join(""),s=await crypto.subtle.digest("MD5",e.encode(r.slice(7,27)));return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("").toLowerCase()}async function _$a(t){var e=t.replace(/[\t"'\r\n]+/g,",").replace(/,+/g,",");return","==e.charAt(0)&&(e=e.slice(1)),","==e.charAt(e.length-1)&&(e=e.slice(0,-1)),e.split(",")}let _$c,_$pi="",_$s5=null,_$gp=!1,_$sa="",_$pa={},_$cp,_$ca,_$ci=0,_$ef=!0,_$doh="https://doh.cmliussss.net/CMLiussss",_$wl=["*tapecontent.net","*cloudatacdn.com","*loadshare.org","*cdn-centaurus.com","scholar.google.com"];const _$pg="https://edt-pages.github.io";export default{async fetch(t,n,r){const s=new URL(t.url),o=t.headers.get("User-Agent")||"null",a=t.headers.get("Upgrade"),i=n.ADMIN||n.admin||n.PASSWORD||n.password||n.pswd||n.TOKEN||n.KEY||n.UUID||n.uuid||_$d("<ec42><a502><f89d><2b63><9361><b6b7><4453><a2>"),c=n.KEY||_$d("<ec42><a502><f89d><2b63><93dc><434b><5a78><0ae8><7db7><f0d6>"),l=await _$m(i+c),u=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/,d=n.UUID||n.uuid,p=d&&u.test(d)?d.toLowerCase():[l.slice(0,8),l.slice(8,12),"4"+l.slice(13,16),"8"+l.slice(17,20),l.slice(20)].join("-"),f=n.HOST?(await _$a(n.HOST)).map(e=>e.toLowerCase().replace(/^https?:\/\//,"").split("/")[0].split(":")[0]):[s.hostname],h=f[0];if(n.PROXYIP){const e=await _$a(n.PROXYIP);_$pi=e[Math.floor(Math.random()*e.length)],_$ef=!1}else _$pi=(t.cf.colo+_$d("<4ced><dba4><be9c><4e64><6a91><8212><9f1b><b174><bd5b><7714><fdf3>")).toLowerCase();const g=t.headers.get("X-Real-IP")||t.headers.get("CF-Connecting-IP")||t.headers.get("X-Forwarded-For")||"unknown";if(n.GO2SOCKS5&&(_$wl=await _$a(n.GO2SOCKS5)),_$doh=n.ECH_DOH||n.DOH||_$doh,!a||"websocket"!==a){if("http:"===s.protocol)return Response.redirect(s.href.replace("http://"+s.hostname,"https://"+s.hostname),301);const e=s.pathname.slice(1).toLowerCase(),r=n.TWO_PROXY||n.two_proxy||"",_k=n.ACCESSKEY||n.ACCESS_KEY||n.AKEY||_$gk(l);if(""===e||"/"===e)return new Response(_$n,{status:200,headers:{"Content-Type":"text/html","Server":"nginx/1.18.0"}});if(_$d("<10ef><0af9><e71a><b92d><f8e2>")===e){const e=_$d("<3d1a><3222><f36a><d913><9f43><cfb0><4965><7d40><f4>")+_k+_$d("<bc90><8841><a5b0><3528><bb9b><a03c><12a7><17d3><ce11><7bf9><fbc3><9874><e31b><9446><97e9>")+s.hostname+_$d("<57ff><00e5><88b4><ccc6><ac55><6c33>")+_k+_$d("<bc90><510e><99d9><9563><a1a0><8d62><500a><6553><4599><39b9><3333><0e53><ac3a><9b97><84d7><7791><712d><4948><026d><49d2><8a83><af01><f913><b743><32ed><c647><39be><f5a4><e1ec><bd74><3591><1668><f087><c914><926c><0879><46f2><2c86><5e5a><5d52><56e4><d842><5c36><0fe2><1297><30bf><2104><6426><3466><83c0><2575><b088><46b3><4d56><72de><0111><06f1><3ac9><8237><5e9a><138a><3175><67f1><76f9><2789><8683><d195><e6eb><ed5f><690d><8538>"),t=_$e(e);return new Response(t,{headers:{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","X-Enc":"x27cn","X-Hint":"Decrypt with key: x27cn2026"}})}const _op=s.pathname.slice(1);if(e.startsWith(_$d("<10ef><0af9><e71a><b92d><f8e2>")+"/")){const o=_op.substring(11);if(o!==_k){const e=_$d("<9fe9><9c87><ec34><a89e><1631><26e6><8a41><7e41><f9de><4b45><6a18><0071><ee7b><0969><1ce5><8e32><bd0d><4699><dddc><a3c5><f0b5><a338><1f68><b55c><3ed9><9050><1446><7c32><61af><40d7><88>");return new Response(_$e(e),{status:403,headers:{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","X-Enc":"x27cn"}})}const a=t.cf?.colo||"UNKNOWN",i="/"+p+(r?"?two_proxy="+encodeURIComponent(r):""),c="vless://"+p+"@"+s.hostname+":443?security=tls&type=ws&host="+s.hostname+"&sni="+s.hostname+"&path="+encodeURIComponent(i)+"&encryption=none#Node-"+a,l={status:"online",version:"1.8.7",colo:a,host:s.hostname,uuid:p,vless:c,two_proxy:r||null,proxyip:_$pi},u=_$e(JSON.stringify(l),o);return new Response(u,{headers:{"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","X-Enc":"x27cn","X-Key":o}})}return new Response(JSON.stringify({error:"Unknown endpoint",available:["/x2727admin"]}),{status:404,headers:{"Content-Type":"application/json"}})}return new Response(null,{status:101})}};